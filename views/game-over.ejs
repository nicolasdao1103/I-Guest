<%- include('partials/header', { title: 'K·∫øt th√∫c!' }) %>

<div class="game-over">
    <h1>Tr√≤ ch∆°i k·∫øt th√∫c!</h1>
    
    <div class="podium">
        <div class="rank first">
            <h2>1<small>st</small></h2>
            <p id="winner-1">...</p>
        </div>
        <div class="rank second">
            <h2>2<small>nd</small></h2>
            <p id="winner-2">...</p>
        </div>
        <div class="rank third">
            <h2>3<small>rd</small></h2>
            <p id="winner-3">...</p>
        </div>
    </div>

    <div id="congrats-message" class="congrats-message">
        </div>
    <% if (user && user.role === 'host') { %>
        <a href="/host-dashboard" class="btn">Ch∆°i l·∫°i</a>
    <% } else { %>
        <a href="/user-dashboard" class="btn">Ch∆°i l·∫°i</a>
    <% } %>
    <% if (user && user.role === 'host') { %>
        <a href="/dashboard" class="btn btn-primary">V·ªÅ trang qu·∫£n l√Ω</a>
    <% } %>
</div>

<script>
    const finalScores = JSON.parse(sessionStorage.getItem('finalScores'));
    const myName = sessionStorage.getItem('name'); // T√™n c·ªßa ng∆∞·ªùi ch∆°i hi·ªán t·∫°i

    if (finalScores) {
        // Hi·ªÉn th·ªã top 3
        if (finalScores[0]) document.getElementById('winner-1').textContent = finalScores[0].name;
        if (finalScores[1]) document.getElementById('winner-2').textContent = finalScores[1].name;
        if (finalScores[2]) document.getElementById('winner-3').textContent = finalScores[2].name;

        // T√¨m th·ª© h·∫°ng c·ªßa ng∆∞·ªùi ch∆°i hi·ªán t·∫°i v√† hi·ªÉn th·ªã tin nh·∫Øn
        if (myName) {
            const myRank = finalScores.findIndex(p => p.name === myName) + 1;
            if (myRank > 0 && myRank <= 10) {
                const message = `Ch√∫c m·ª´ng b·∫°n ƒë√£ ƒë·∫°t th·ª© h·∫°ng ${myRank}/10! üéâ`;
                document.getElementById('congrats-message').textContent = message;
            }
        }
    }

    // X√≥a d·ªØ li·ªáu game kh·ªèi session storage
    sessionStorage.removeItem('pin');
    sessionStorage.removeItem('name');
    sessionStorage.removeItem('leaderboardData');
    sessionStorage.removeItem('finalScores');
</script>

<%- include('partials/footer') %>